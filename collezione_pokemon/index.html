<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Collezione Pokèmon</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f2f2f2; margin: 0; padding: 0; }
    header { display: flex; align-items: center; gap: 15px; background: #fff; padding: 15px; border-bottom: 1px solid #ccc; }
    header img { height: 60px; }
    header h1 { margin: 0; font-size: 24px; color: #333; }
    .era-container { margin: 20px auto; padding: 20px; max-width: 900px; background: #fff; border-radius: 10px; }
    .era-title { font-size: 28px; font-weight: bold; margin-bottom: 20px; border-left: 6px solid #ffcb05; padding-left: 10px; }
    .set-card { display: flex; align-items: center; justify-content: space-between; background: #fafafa; padding: 12px 18px; border-radius: 10px; margin: 10px 0; border: 1px solid #ddd; }
    .set-info { display: flex; align-items: center; gap: 10px; }
    .set-info img { height: 40px; }
    .progress { width: 160px; height: 18px; background: #ddd; border-radius: 10px; overflow: hidden; text-align: center; font-size: 12px; line-height: 18px; color: #fff; }
    .progress-bar { height: 100%; background: #4caf50; display: flex; align-items: center; justify-content: center; }
  </style>
</head>
<body>
  <header>
    <img src="assets/logo_pokemon.png" alt="Pokémon Logo">
    <h1>Collezione Pokèmon</h1>
  </header>

  <div id="content">
    <p style="text-align:center; margin-top:50px;">Caricamento dati...</p>
  </div>

  <script>
    // Caricamento dei JSON
    Promise.all([
      fetch('sets.json').then(r => r.json()),
      fetch('cards.json').then(r => r.json())
    ]).then(([setsData, cardsData]) => {
      renderPage(setsData, cardsData);
    }).catch(err => {
      const content = document.getElementById("content");
      content.innerHTML = "<p style='color:red; text-align:center;'>Errore nel caricamento dei dati</p>";
      console.error(err);
    });

    function renderPage(sets, cards) {
      const content = document.getElementById("content");
      content.innerHTML = "";

      // Aggiungi conteggio possedute a ogni set
      sets.forEach(set => {
        const possedute = cards.filter(c => c.ID_Set === set.ID)
                               .reduce((sum, c) => sum + (c.Posseduta ? 1 : 0), 0);
        set.Possedute = possedute;
      });

      // Raggruppa per era
      const eras = {};
      sets.forEach(set => {
        if (!eras[set.Era]) eras[set.Era] = [];
        eras[set.Era].push(set);
      });

      for (let era in eras) {
        const eraBox = document.createElement("div");
        eraBox.className = "era-container";

        const title = document.createElement("div");
        title.className = "era-title";
        title.textContent = era;
        eraBox.appendChild(title);

        eras[era].forEach(set => {
          const card = document.createElement("div");
          card.className = "set-card";

          const info = document.createElement("div");
          info.className = "set-info";

          const img = document.createElement("img");
          img.src = set.Nome_Logo ? `assets/${set.Nome_Logo}` : "";
          img.alt = set.Nome_Set;

          const name = document.createElement("div");
          name.textContent = set.Nome_Set;

          info.appendChild(img);
          info.appendChild(name);

          const progress = document.createElement("div");
          progress.className = "progress";

          const bar = document.createElement("div");
          bar.className = "progress-bar";

          const possedute = set.Possedute || 0;
          const totale = set.Totale_Carte || 0;
          const perc = totale ? Math.round((possedute / totale) * 100) : 0;

          bar.style.width = perc + "%";
          bar.textContent = `${possedute} / ${totale}`;

          progress.appendChild(bar);

          card.appendChild(info);
          card.appendChild(progress);
          eraBox.appendChild(card);
        });

        content.appendChild(eraBox);
      }
    }
  </script>
</body>
</html>